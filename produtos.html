<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>KM ‚Äî Produtos</title>

  <link rel="stylesheet" href="assets/styles.css" />
  <link rel="stylesheet" href="assets/km.css" />

  <!-- Estilos leves para os minifiltros (selects) e corre√ß√£o do X no desktop -->
  <style>
    .km-mini-selects { display:grid; gap:8px; grid-template-columns:1fr; }
    .km-mini-selects .row { display:grid; gap:6px; }
    .km-mini-selects label { font-size:.82rem; color:#0f172a; }
    .km-mini-select {
      appearance:none; width:100%; height:36px; padding:0 12px;
      border:1px solid #e5e7eb; border-radius:10px; background:#fff;
      font-weight:600; color:#0f3f74; cursor:pointer;
      background-image: linear-gradient(45deg, transparent 50%, #0f3f74 50%), linear-gradient(135deg, #0f3f74 50%, transparent 50%);
      background-position: calc(100% - 18px) calc(50% - 2px), calc(100% - 12px) calc(50% - 2px);
      background-size: 6px 6px, 6px 6px; background-repeat:no-repeat;
    }
    /* escondemos as caixinhas antigas mas mantemos no DOM pro JS */
    .km-filter-checkboxes { display:none !important; }

    /* For√ßa esconder o bot√£o X no desktop */
    @media (min-width:921px){
      #kmFiltersClose { display:none !important; }
      .km-mini-selects { grid-template-columns:1fr 1fr; }
    }
  </style>
</head>
<body>
  <!-- HEADER IGUAL AO INDEX -->
  <header class="km-topbar">
    <div class="km-topbar-inner">
      <a href="admin.html" class="km-logo">
        <img src="assets/km-logo.jpg" alt="KM">
      </a>
      <nav class="km-nav-desktop">
        <a href="index.html">In√≠cio</a>
        <a href="sobre.html">Sobre n√≥s</a>
        <a href="produtos.html" class="active">Produtos</a>
        <a href="onde-comprar.html">Onde comprar</a>
        <a href="garantia.html">Garantia</a>
      </nav>
      <button class="km-hamburger" id="kmHamburger" aria-label="Abrir menu">
        <span></span><span></span><span></span>
      </button>
    </div>
    <div class="km-search-wrap">
      <input type="search" id="kmSearch" placeholder="Pesquisar produtos..." />
      <button id="kmSearchBtn">üîç</button>
    </div>
  </header>

  <!-- DRAWER MOBILE -->
  <aside class="km-drawer" id="kmDrawer">
    <div class="km-drawer-head">
      <img src="assets/km-logo.jpg" alt="KM">
      <button id="kmDrawerClose" aria-label="Fechar">√ó</button>
    </div>
    <nav class="km-drawer-nav">
      <a href="index.html">In√≠cio</a>
      <a href="sobre.html">Sobre n√≥s</a>
      <a href="produtos.html" class="active">Produtos</a>
      <a href="onde-comprar.html">Onde comprar</a>
      <a href="garantia.html">Garantia</a>
      <a href="admin.html">Painel admin</a>
    </nav>
  </aside>
  <div class="km-overlay" id="kmOverlay"></div>

  <!-- CONTE√öDO -->
  <main class="km-page km-prod-page">
    <div class="km-prod-head">
      <div>
        <h1>Todos os produtos</h1>
        <p id="kmProdCount">Carregando...</p>
      </div>
      <button class="km-btn-filter-mobile" id="kmOpenFilters">Filtros</button>
    </div>

    <div class="km-prod-layout">
      <!-- LATERAL / MODAL DE FILTROS -->
      <aside class="km-prod-filters" id="kmFilters">
        <div class="km-filters-head">
          <span class="km-filters-title">Filtrar por</span>
          <!-- X s√≥ no mobile (for√ßado a sumir no desktop acima) -->
          <button type="button" class="km-filters-close" id="kmFiltersClose" aria-label="Fechar filtros">√ó</button>
        </div>

        <div class="km-filter-block">
          <h3>Categorias</h3>
          <ul id="kmFilterCategorias"><!-- via JS --></ul>
        </div>

        <div class="km-filter-block">
          <h3>Marcas</h3>
          <ul id="kmFilterMarcas"><!-- via JS --></ul>
        </div>

        <div class="km-filter-block">
          <h3>Tipo</h3>

          <!-- NOVOS MINIFILTROS -->
          <div class="km-mini-selects" aria-label="Filtros r√°pidos">
            <div class="row">
              <label for="kmSelectEx">Exibi√ß√£o</label>
              <select id="kmSelectEx" class="km-mini-select">
                <option value="todos">Todos</option>
                <option value="exclusivos">Exclusivos</option>
                <option value="comum">Comum</option>
              </select>
            </div>
            <div class="row">
              <label for="kmSelectNv">Status</label>
              <select id="kmSelectNv" class="km-mini-select">
                <option value="todos">Todos</option>
                <option value="novos">Novos</option>
                <option value="padrao">Padr√£o</option>
              </select>
            </div>
          </div>

          <!-- Checkboxes originais (ocultos) preservados para o JS -->
          <div class="km-filter-checkboxes" style="display:none">
            <label><input type="checkbox" value="exclusivo" id="kmFilterExclusivo"> Exclusivos</label>
            <label><input type="checkbox" value="novo" id="kmFilterNovo"> Itens novos</label>
          </div>
        </div>

        <button id="kmClearFilters" class="km-btn-clear">Limpar filtros</button>
      </aside>

      <!-- LISTA DE PRODUTOS -->
      <section class="km-prod-list" id="kmProdList"><!-- cards via js --></section>
    </div>
  </main>

  <!-- MODAL DE DETALHES DO PRODUTO -->
  <div id="kmModalOverlay" class="km-modal-overlay" style="display:none;">
    <div class="km-modal">
      <button id="kmModalClose" class="km-modal-close" aria-label="Fechar">√ó</button>
      <div class="km-modal-body">
        <div class="km-modal-media" id="kmModalMedia">
          <img id="kmModalImg" src="assets/b1.svg" alt="Produto KM">
        </div>
        <div class="km-modal-content">
          <h2 id="kmModalTitle">Produto KM</h2>
          <p id="kmModalDesc" class="km-modal-desc">Descri√ß√£o do produto vai aparecer aqui.</p>
          <h3 class="km-modal-subtitle">Especifica√ß√µes</h3>
          <ul id="kmModalSpecs" class="km-modal-specs"></ul>
          <div class="km-modal-tags" id="kmModalTags"></div>
        </div>
      </div>
    </div>
  </div>

  <footer class="km-footer">
    <p class="km-copy">¬© 2025 KM ‚Äî Todos os direitos reservados.</p>
  </footer>

  <!-- FIREBASE -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  <script src="assets/config.js"></script>

  <!-- JS da p√°gina -->
  <script src="assets/produtos-km.js"></script>

  <!-- UI: menu, filtros mobile, selects sincronizados e zoom desktop -->
  <script>
    /* ===== Drawer (menu) ===== */
    const hb = document.getElementById('kmHamburger');
    const drawer = document.getElementById('kmDrawer');
    const overlay = document.getElementById('kmOverlay');
    const btnClose = document.getElementById('kmDrawerClose');
    const openDrawer = ()=>{ drawer.classList.add('open'); overlay.classList.add('show'); };
    const closeDrawer = ()=>{ drawer.classList.remove('open'); overlay.classList.remove('show'); };
    if (hb) hb.onclick = openDrawer;
    if (overlay) overlay.onclick = closeDrawer;
    if (btnClose) btnClose.onclick = closeDrawer;

    /* ===== Filtros como MODAL no mobile ===== */
    const openFiltersBtn = document.getElementById('kmOpenFilters');
    const filters = document.getElementById('kmFilters');
    const filtersClose = document.getElementById('kmFiltersClose');
    const filtersOv = document.createElement('div');
    filtersOv.className = 'km-filters-overlay';
    document.body.appendChild(filtersOv);
    const isMobile = () => matchMedia('(max-width: 920px)').matches;
    function openFilters(){ if(!isMobile()) return; filters.classList.add('show-mobile'); filtersOv.classList.add('show'); document.documentElement.style.overflow='hidden'; document.body.style.overflow='hidden'; }
    function closeFilters(){ filters.classList.remove('show-mobile'); filtersOv.classList.remove('show'); document.documentElement.style.overflow=''; document.body.style.overflow=''; }
    if (openFiltersBtn) openFiltersBtn.addEventListener('click', openFilters);
    if (filtersClose)   filtersClose.addEventListener('click', closeFilters);
    filtersOv.addEventListener('click', closeFilters);
    window.addEventListener('keydown', e=>{ if(e.key==='Escape') closeFilters(); });

    /* ===== Selects ‚Üí sincronizam ‚Äúlimpar filtros‚Äù ===== */
    const selEx = document.getElementById('kmSelectEx');
    const selNv = document.getElementById('kmSelectNv');
    const btnClear = document.getElementById('kmClearFilters');
    if (btnClear){
      btnClear.addEventListener('click', ()=>{
        if (selEx) selEx.value = 'todos';
        if (selNv) selNv.value = 'todos';
      });
    }
  </script>
</body>
</html>
