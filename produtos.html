<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>KM ‚Äî Produtos</title>

  <link rel="stylesheet" href="assets/styles.css" />
  <link rel="stylesheet" href="assets/km.css" />

  <style>
    /* ===== FILTROS COMO MODAL (apenas MOBILE) ===== */
    .km-filters-close{ display:none; }

    @media (max-width:920px){
      /* layout vira coluna; a sidebar vira modal */
      .km-prod-layout{ display:block; }

      /* backdrop do modal */
      .km-filters-backdrop{
        position:fixed; inset:0;
        background:rgba(0,0,0,.45);
        opacity:0; pointer-events:none;
        transition:opacity .25s ease;
        z-index:1090;
      }
      .km-filters-backdrop.show{ opacity:1; pointer-events:auto; }

      /* a PR√ìPRIA sidebar vira o modal central */
      .km-prod-filters{
        position:fixed;
        left:50%; top:50%;
        transform:translate(-50%,-50%) scale(.97);
        width:92vw; max-width:420px;
        max-height:80vh;
        background:#fff;
        border-radius:16px;
        box-shadow:0 16px 40px rgba(0,0,0,.25);
        padding:16px 16px 12px;
        overflow:auto;
        z-index:1100;
        opacity:0; pointer-events:none;
        transition:opacity .25s ease, transform .25s ease;
      }
      .km-prod-filters.show-mobile{
        opacity:1; pointer-events:auto;
        transform:translate(-50%,-50%) scale(1);
      }

      /* bot√£o X no topo direito */
      .km-filters-close{
        display:block;
        position:absolute; top:10px; right:10px;
        width:36px; height:36px;
        border:none; background:#0b1a33; color:#fff;
        border-radius:10px; font-size:20px; line-height:1;
        cursor:pointer;
      }

      /* t√≠tulo e grupos visualmente agrad√°veis */
      .km-prod-filters h2{
        margin:4px 0 12px; text-align:center; color:#0b1a33;
      }
      .km-filter-block{
        background:#f7f9fc; border:1px solid rgba(0,0,0,.05);
        border-radius:12px; padding:10px 12px; margin-bottom:10px;
      }
      .km-filter-block h3{ margin:0 0 6px; color:#0b1a33; }
      .km-btn-clear{
        width:100%; margin-top:4px;
      }

      /* bot√£o que abre o modal */
      .km-btn-filter-mobile{
        background:#0b1a33; color:#fff; border:none;
        padding:.6rem 1.2rem; border-radius:10px; font-weight:600;
      }
    }
  </style>
</head>
<body>
  <!-- HEADER IGUAL AO INDEX -->
  <header class="km-topbar">
    <div class="km-topbar-inner">
      <a href="admin.html" class="km-logo">
        <img src="assets/km-logo.jpg" alt="KM">
      </a>
      <nav class="km-nav-desktop">
        <a href="index.html">In√≠cio</a>
        <a href="sobre.html">Sobre n√≥s</a>
        <a href="produtos.html" class="active">Produtos</a>
        <a href="onde-comprar.html">Onde comprar</a>
        <a href="garantia.html">Garantia</a>
      </nav>
      <button class="km-hamburger" id="kmHamburger" aria-label="Abrir menu">
        <span></span><span></span><span></span>
      </button>
    </div>
    <div class="km-search-wrap">
      <input type="search" id="kmSearch" placeholder="Pesquisar produtos..." />
      <button id="kmSearchBtn">üîç</button>
    </div>
  </header>

  <!-- DRAWER MOBILE -->
  <aside class="km-drawer" id="kmDrawer">
    <div class="km-drawer-head">
      <img src="assets/km-logo.jpg" alt="KM">
      <button id="kmDrawerClose" aria-label="Fechar">√ó</button>
    </div>
    <nav class="km-drawer-nav">
      <a href="index.html">In√≠cio</a>
      <a href="sobre.html">Sobre n√≥s</a>
      <a href="produtos.html">Produtos</a>
      <a href="onde-comprar.html">Onde comprar</a>
      <a href="garantia.html">Garantia</a>
      <a href="admin.html">Painel admin</a>
    </nav>
  </aside>
  <div class="km-overlay" id="kmOverlay"></div>

  <!-- CONTE√öDO -->
  <main class="km-page km-prod-page">
    <div class="km-prod-head">
      <div>
        <h1>Todos os produtos</h1>
        <p id="kmProdCount">Carregando...</p>
      </div>
      <button class="km-btn-filter-mobile" id="kmOpenFilters">Filtros</button>
    </div>

    <div class="km-prod-layout">
      <!-- BACKDROP do modal (s√≥ mobile) -->
      <div id="kmFiltersBackdrop" class="km-filters-backdrop"></div>

      <!-- LATERAL DE FILTROS (no mobile vira o MODAL central) -->
      <aside class="km-prod-filters" id="kmFilters">
        <button class="km-filters-close" id="kmCloseFilters" aria-label="Fechar filtros">√ó</button>
        <h2>Filtrar por</h2>

        <div class="km-filter-block">
          <h3>Categorias</h3>
          <ul id="kmFilterCategorias"></ul>
        </div>

        <div class="km-filter-block">
          <h3>Marcas</h3>
          <ul id="kmFilterMarcas"></ul>
        </div>

        <div class="km-filter-block">
          <h3>Tipo</h3>
          <label><input type="checkbox" value="exclusivo" id="kmFilterExclusivo"> Exclusivos</label>
          <label><input type="checkbox" value="novo" id="kmFilterNovo"> Itens novos</label>
        </div>

        <button id="kmClearFilters" class="km-btn-clear">Limpar filtros</button>
      </aside>

      <!-- LISTA DE PRODUTOS -->
      <section class="km-prod-list" id="kmProdList"></section>
    </div>
  </main>

  <!-- MODAL DE DETALHES DO PRODUTO -->
  <div id="kmModalOverlay" class="km-modal-overlay" style="display:none;">
    <div class="km-modal">
      <button id="kmModalClose" class="km-modal-close" aria-label="Fechar">√ó</button>
      <div class="km-modal-body">
        <div class="km-modal-media km-zoom">
          <img id="kmModalImg" src="assets/b1.svg" alt="Produto KM">
        </div>
        <div class="km-modal-content">
          <h2 id="kmModalTitle">Produto KM</h2>
          <p id="kmModalDesc" class="km-modal-desc">Descri√ß√£o do produto vai aparecer aqui.</p>
          <h3 class="km-modal-subtitle">Especifica√ß√µes</h3>
          <ul id="kmModalSpecs" class="km-modal-specs"></ul>
          <div class="km-modal-tags" id="kmModalTags"></div>
        </div>
      </div>
    </div>
  </div>

  <footer class="km-footer">
    <p class="km-copy">¬© 2025 KM ‚Äî Todos os direitos reservados.</p>
  </footer>

  <!-- FIREBASE -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  <script src="assets/config.js"></script>

  <!-- JS da p√°gina -->
  <script src="assets/produtos-km.js"></script>

  <!-- JS UI -->
  <script>
    // Drawer (menu)
    const hb = document.getElementById('kmHamburger');
    const drawer = document.getElementById('kmDrawer');
    const overlay = document.getElementById('kmOverlay');
    const btnClose = document.getElementById('kmDrawerClose');
    function openDrawer(){ drawer.classList.add('open'); overlay.classList.add('show'); }
    function closeDrawer(){ drawer.classList.remove('open'); overlay.classList.remove('show'); }
    if (hb) hb.onclick = openDrawer;
    if (overlay) overlay.onclick = closeDrawer;
    if (btnClose) btnClose.onclick = closeDrawer;

    // Filtros mobile (modal centralizado)
    const openFilters = document.getElementById('kmOpenFilters');
    const closeFilters = document.getElementById('kmCloseFilters');
    const filters = document.getElementById('kmFilters');
    const filtersBackdrop = document.getElementById('kmFiltersBackdrop');

    function openFiltersModal(){
      filters.classList.add('show-mobile');
      if (filtersBackdrop) filtersBackdrop.classList.add('show');
      // trava scroll do body
      document.documentElement.style.overflow = 'hidden';
      document.body.style.overflow = 'hidden';
    }
    function closeFiltersModal(){
      filters.classList.remove('show-mobile');
      if (filtersBackdrop) filtersBackdrop.classList.remove('show');
      // libera scroll do body
      document.documentElement.style.overflow = '';
      document.body.style.overflow = '';
    }

    if (openFilters && filters){
      openFilters.addEventListener('click', openFiltersModal);
    }
    if (closeFilters){
      closeFilters.addEventListener('click', closeFiltersModal);
    }
    if (filtersBackdrop){
      filtersBackdrop.addEventListener('click', closeFiltersModal);
    }
  </script>
</body>
</html>
